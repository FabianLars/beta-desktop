name: "publish"
on:
  workflow_dispatch:
  push:

env:
  CARGO_INCREMENTAL: 0
  RUST_BACKTRACE: short
  # RUSTFLAGS: '-D warnings -W unreachable-pub -W rust-2021-compatibility'
  RUSTFLAGS: "-W unreachable-pub -W rust-2021-compatibility"

jobs:
  publish-tauri:
    permissions: write-all
    strategy:
      fail-fast: false
      matrix:
        settings:
          #- platform: "macos-latest"
          #  args: "--target universal-apple-darwin"
          #- platform: 'macos-latest'
          #  args: '--target x86_64-apple-darwin'
          #- platform: 'macos-latest'
          #  args: '--target aarch64-apple-darwin'
          #- platform: 'macos-latest'
          #  args: '--target aarch64-apple-darwin'
          - platform: "ubuntu-22.04"
            args: ""
          #- platform: "windows-latest"
          #  args: "--target x86_64-pc-windows-msvc"
          #- platform: "windows-latest"
          #  args: "--target i686-pc-windows-msvc"

    runs-on: ${{ matrix.settings.platform }}
    steps:
      - uses: actions/checkout@v4

      - run: mkdir /mnt/target

      - run: |
          pwd
          echo
          df -h .
          echo
          ls -la .
          echo
          cd /mnt/target
          echo
          pwd
          echo
          ls -la .
          echo
          df -h .
          echo
          cd /mnt
          echo
          pwd
          echo
          ls -la .
          echo
          df -h .
          echo
          pwd -P
